---

# Don't just bind to 127.0.0.1, else tsa cannot connect to it (it will use the bosh link address) and nothing actually works
# TODO, keep an eye on https://github.com/concourse/concourse/issues/1466 for a workaround, then add this again
#- type: replace
#  path: /instance_groups/name=web/jobs/name=atc/properties?/bind_ip
#  value: 127.0.0.1

- type: replace
  path: /instance_groups/name=web/jobs/name=atc/properties?/bind_port
  value: 8080

- type: replace
  path: /releases/-
  value:
    name: instant-https
    url: https://github.com/govau/instant-https-boshrelease/releases/download/v0.4.0/instant-https-0.4.0.tgz
    sha1: f603d51ce64efb0145a2842245404946782b1827
    version: latest

- type: replace
  path: /instance_groups/name=web/jobs/-
  value:
    name: proxy
    release: instant-https
    properties:
      hostname: ((external-hostname))
      contact_email: ((cert-contact-email))
      acme_url: ((acme-api-url))
      backends: ["127.0.0.1:8080"]
      websocket: true
