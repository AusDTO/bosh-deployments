
# Prometheus Alerts
- type: replace
  path: /instance_groups/name=prometheus/jobs/name=cloudfoundry_alerts?/release
  value: prometheus

- type: replace
  path: /instance_groups/name=prometheus/jobs/name=prometheus/properties/prometheus/rule_files/-
  value: /var/vcap/jobs/cloudfoundry_alerts/*.alerts

# Grafana Dashboards
- type: replace
  path: /instance_groups/name=grafana/jobs/name=cloudfoundry_dashboards?/release
  value: prometheus

- type: replace
  path: /instance_groups/name=grafana/jobs/name=grafana/properties/grafana/prometheus/dashboard_files/-
  value: /var/vcap/jobs/cloudfoundry_dashboards/*.json


# Exporter jobs
- type: replace
  path: /instance_groups/-
  value:
    name: cf_firehose_legacy_staging
    azs: [ z1, z2, z3 ]
    instances: 1
    vm_type: small
    stemcell: default
    vm_extensions: [monitoring]
    networks:
      - name: Support
    jobs:
      - name: cf_exporter
        release: prometheus
        properties:
          cf_exporter:
            cf:
              api_url: https://api.system.staging.digital.gov.au
              client_id: cf_exporter
              client_secret: "((uaa_clients_cf_exporter_secret_staging))"
              deployment_name: cf
            metrics:
              environment: staging-digital-gov-au
      - name: firehose_exporter
        release: prometheus
        properties:
          firehose_exporter:
            doppler:
              url: wss://doppler.system.staging.digital.gov.au:4443
              subscription_id: staging-digital-gov-au-root
              max_retry_count: 300
            uaa:
              url: https://uaa.system.staging.digital.gov.au
              client_id: firehose_exporter
              client_secret: "((uaa_clients_firehose_exporter_secret_staging))"
            metrics:
              environment: staging-digital-gov-au
- type: replace
  path: /instance_groups/-
  value:
    name: cf_firehose_legacy_platform
    azs: [ z1, z2, z3 ]
    instances: 1
    vm_type: small
    stemcell: default
    vm_extensions: [monitoring]
    networks:
      - name: Support
    jobs:
      - name: cf_exporter
        release: prometheus
        properties:
          cf_exporter:
            cf:
              api_url: https://api.system.platform.digital.gov.au
              client_id: cf_exporter
              client_secret: "((uaa_clients_cf_exporter_secret_platform))"
              deployment_name: cf
            metrics:
              environment: platform-digital-gov-au
      - name: firehose_exporter
        release: prometheus
        properties:
          firehose_exporter:
            doppler:
              url: wss://doppler.system.platform.digital.gov.au:4443
              subscription_id: platform-digital-gov-au-root
              max_retry_count: 300
            uaa:
              url: https://uaa.system.platform.digital.gov.au
              client_id: firehose_exporter
              client_secret: "((uaa_clients_firehose_exporter_secret_platform))"
            metrics:
              environment: platform-digital-gov-au
- type: replace
  path: /instance_groups/-
  value:
    name: cf_firehose_b
    azs: [ z1, z2, z3 ]
    instances: 1
    vm_type: small
    stemcell: default
    vm_extensions: [monitoring]
    networks:
      - name: Support
    jobs:
      - name: cf_exporter
        release: prometheus
        properties:
          cf_exporter:
            cf:
              api_url: https://api.system.b.cld.gov.au
              client_id: cf_exporter
              client_secret: "((uaa_clients_cf_exporter_secret_b_cld))"
              deployment_name: cf
            metrics:
              environment: b-cld-gov-au
      - name: firehose_exporter
        release: prometheus
        properties:
          firehose_exporter:
            doppler:
              url: wss://doppler.system.b.cld.gov.au:4443
              subscription_id: b-cld-gov-au-root
              max_retry_count: 300
            uaa:
              url: https://uaa.system.b.cld.gov.au
              client_id: firehose_exporter
              client_secret: "((uaa_clients_firehose_exporter_secret_b_cld))"
            metrics:
              environment: b-cld-gov-au
- type: replace
  path: /instance_groups/-
  value:
    name: cf_firehose_d
    azs: [ z1, z2, z3 ]
    instances: 1
    vm_type: small
    stemcell: default
    vm_extensions: [monitoring]
    networks:
      - name: Support
    jobs:
      - name: cf_exporter
        release: prometheus
        properties:
          cf_exporter:
            cf:
              api_url: https://api.system.d.cld.gov.au
              client_id: cf_exporter
              client_secret: "((uaa_clients_cf_exporter_secret_d_cld))"
              deployment_name: cf
            metrics:
              environment: d-cld-gov-au
      - name: firehose_exporter
        release: prometheus
        properties:
          firehose_exporter:
            doppler:
              url: wss://doppler.system.d.cld.gov.au:4443
              subscription_id: d-cld-gov-au-root
              max_retry_count: 300
            uaa:
              url: https://uaa.system.d.cld.gov.au
              client_id: firehose_exporter
              client_secret: "((uaa_clients_firehose_exporter_secret_d_cld))"
            metrics:
              environment: d-cld-gov-au
- type: replace
  path: /instance_groups/-
  value:
    name: cf_firehose_y
    azs: [ z1, z2, z3 ]
    instances: 1
    vm_type: small
    stemcell: default
    vm_extensions: [monitoring]
    networks:
      - name: Support
    jobs:
      - name: cf_exporter
        release: prometheus
        properties:
          cf_exporter:
            cf:
              api_url: https://api.system.y.cld.gov.au
              client_id: cf_exporter
              client_secret: "((uaa_clients_cf_exporter_secret_y_cld))"
              deployment_name: cf
            metrics:
              environment: y-cld-gov-au
      - name: firehose_exporter
        release: prometheus
        properties:
          firehose_exporter:
            doppler:
              url: wss://doppler.system.y.cld.gov.au:4443
              subscription_id: y-cld-gov-au-root
              max_retry_count: 300
            uaa:
              url: https://uaa.system.y.cld.gov.au
              client_id: firehose_exporter
              client_secret: "((uaa_clients_firehose_exporter_secret_y_cld))"
            metrics:
              environment: y-cld-gov-au
- type: replace
  path: /instance_groups/-
  value:
    name: cf_firehose_z
    azs: [ z1, z2, z3 ]
    instances: 1
    vm_type: small
    stemcell: default
    vm_extensions: [monitoring]
    networks:
      - name: Support
    jobs:
      - name: cf_exporter
        release: prometheus
        properties:
          cf_exporter:
            cf:
              api_url: https://api.system.z.cld.gov.au
              client_id: cf_exporter
              client_secret: "((uaa_clients_cf_exporter_secret_z_cld))"
              deployment_name: cf
            metrics:
              environment: z-cld-gov-au
      - name: firehose_exporter
        release: prometheus
        properties:
          firehose_exporter:
            doppler:
              url: wss://doppler.system.z.cld.gov.au:4443
              subscription_id: z-cld-gov-au-root
              max_retry_count: 300
            uaa:
              url: https://uaa.system.z.cld.gov.au
              client_id: firehose_exporter
              client_secret: "((uaa_clients_firehose_exporter_secret_z_cld))"
            metrics:
              environment: z-cld-gov-au

- type: replace
  path: /variables/-
  value:
    name: uaa_clients_cf_exporter_secret_staging
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_cf_exporter_secret_platform
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_cf_exporter_secret_b_cld
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_cf_exporter_secret_d_cld
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_cf_exporter_secret_y_cld
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_cf_exporter_secret_z_cld
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_firehose_exporter_secret_staging
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_firehose_exporter_secret_platform
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_firehose_exporter_secret_b_cld
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_firehose_exporter_secret_d_cld
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_firehose_exporter_secret_y_cld
    type: password
- type: replace
  path: /variables/-
  value:
    name: uaa_clients_firehose_exporter_secret_z_cld
    type: password
